<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Put Options LTP Finder</title>
    <link rel    </div>

    <script src="script.js"></script>
    
    <script type="module">
        // Initialize Supabase client
        import { createClient } from 'https://cdn.skypack.dev/@supabase/supabase-js@2';
        
        const supabaseUrl = 'https://hjxftnabwreuryngarax.supabase.co';
        const supabaseAnonKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImhqeGZ0bmFid3JldXJ5bmdhcmF4Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTg2OTI3NTAsImV4cCI6MjA3NDI2ODc1MH0.NrXQYhsPhTHyEmEQzhTJvADQyCaaT_ghRNgS4RMY4Yk';
        
        window.supabase = createClient(supabaseUrl, supabaseAnonKey);

        // Google Sign-In handlers
        document.addEventListener('DOMContentLoaded', () => {
            const googleLoginBtn = document.getElementById('googleLoginBtn');
            const googleSignupBtn = document.getElementById('googleSignupBtn');

            if (googleLoginBtn) {
                googleLoginBtn.addEventListener('click', async () => {
                    try {
                        googleLoginBtn.disabled = true;
                        googleLoginBtn.innerHTML = `
                            <div style="width: 20px; height: 20px; border: 2px solid #4285f4; border-top: 2px solid transparent; border-radius: 50%; animation: spin 1s linear infinite;"></div>
                            Signing in with Google...
                        `;

                        const { data, error } = await window.supabase.auth.signInWithOAuth({
                            provider: 'google',
                            options: {
                                redirectTo: window.location.origin + '/app.html'
                            }
                        });

                        if (error) throw error;
                        
                    } catch (error) {
                        console.error('Google sign-in failed:', error);
                        
                        let errorMessage = 'Google sign-in failed';
                        if (error.message.includes('OAuth') || error.message.includes('redirect_uri')) {
                            errorMessage = 'Google authentication is not properly configured. Please use email/password login.';
                        }
                        
                        document.getElementById('loginError').textContent = errorMessage;
                        document.getElementById('loginError').style.display = 'block';
                        
                        googleLoginBtn.disabled = false;
                        googleLoginBtn.innerHTML = `
                            <svg width="20" height="20" viewBox="0 0 24 24">
                                <path fill="#4285f4" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"/>
                                <path fill="#34a853" d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/>
                                <path fill="#fbbc05" d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"/>
                                <path fill="#ea4335" d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/>
                            </svg>
                            Continue with Google
                        `;
                    }
                });
            }

            if (googleSignupBtn) {
                googleSignupBtn.addEventListener('click', async () => {
                    try {
                        googleSignupBtn.disabled = true;
                        googleSignupBtn.innerHTML = `
                            <div style="width: 20px; height: 20px; border: 2px solid #4285f4; border-top: 2px solid transparent; border-radius: 50%; animation: spin 1s linear infinite;"></div>
                            Signing up with Google...
                        `;

                        const { data, error } = await window.supabase.auth.signInWithOAuth({
                            provider: 'google',
                            options: {
                                redirectTo: window.location.origin + '/app.html'
                            }
                        });

                        if (error) throw error;
                        
                    } catch (error) {
                        console.error('Google signup failed:', error);
                        
                        let errorMessage = 'Google signup failed';
                        if (error.message.includes('OAuth') || error.message.includes('redirect_uri')) {
                            errorMessage = 'Google authentication is not properly configured. Please use email/password signup.';
                        }
                        
                        document.getElementById('registerError').textContent = errorMessage;
                        document.getElementById('registerError').style.display = 'block';
                        
                        googleSignupBtn.disabled = false;
                        googleSignupBtn.innerHTML = `
                            <svg width="20" height="20" viewBox="0 0 24 24">
                                <path fill="#4285f4" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"/>
                                <path fill="#34a853" d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/>
                                <path fill="#fbbc05" d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"/>
                                <path fill="#ea4335" d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/>
                            </svg>
                            Sign up with Google
                        `;
                    }
                });
            }

            // Check for Supabase session on page load
            window.supabase.auth.onAuthStateChange((event, session) => {
                if (event === 'SIGNED_IN' && session) {
                    // Store session data
                    localStorage.setItem('supabaseSession', JSON.stringify(session));
                    localStorage.setItem('authToken', session.access_token);
                    
                    // Close modal and reinitialize app
                    closeAuthModal();
                    if (window.putOptionsLTPFinder) {
                        window.putOptionsLTPFinder.token = session.access_token;
                        window.putOptionsLTPFinder.checkAuthenticationStatus();
                    }
                }
            });
        });

        // Add spin animation for loading
        const style = document.createElement('style');
        style.textContent = `
            @keyframes spin {
                0% { transform: rotate(0deg); }
                100% { transform: rotate(360deg); }
            }
        `;
        document.head.appendChild(style);
    </script>
</head>
</html>ref="styles.css">
</head>
<body>
    <!-- Authentication Modal -->
    <div id="authModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeAuthModal()">&times;</span>
            
            <!-- Login Form -->
            <div id="loginForm" class="auth-form">
                <h2>Welcome Back!</h2>
                <p>Sign in to your Options Dekho account</p>
                
                <div id="loginError" class="error-message" style="display: none;"></div>
                
                <button type="button" class="google-btn" id="googleLoginBtn">
                    <svg width="20" height="20" viewBox="0 0 24 24">
                        <path fill="#4285f4" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"/>
                        <path fill="#34a853" d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/>
                        <path fill="#fbbc05" d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"/>
                        <path fill="#ea4335" d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/>
                    </svg>
                    Continue with Google
                </button>
                
                <div class="divider">
                    <span>or</span>
                </div>
                
                <form onsubmit="handleLogin(event)">
                    <div class="form-group">
                        <label for="loginEmail">Email</label>
                        <input type="email" id="loginEmail" required>
                    </div>
                    <div class="form-group">
                        <label for="loginPassword">Password</label>
                        <input type="password" id="loginPassword" required>
                    </div>
                    <button type="submit" class="auth-btn">Sign In</button>
                </form>
                <p class="auth-switch">
                    Don't have an account? 
                    <a href="#" onclick="showRegisterForm()">Sign up here</a>
                </p>
            </div>

            <!-- Register Form -->
            <div id="registerForm" class="auth-form" style="display: none;">
                <h2>Create Account</h2>
                <p>Join Options Dekho</p>
                
                <div id="registerError" class="error-message" style="display: none;"></div>
                
                <button type="button" class="google-btn" id="googleSignupBtn">
                    <svg width="20" height="20" viewBox="0 0 24 24">
                        <path fill="#4285f4" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"/>
                        <path fill="#34a853" d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/>
                        <path fill="#fbbc05" d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"/>
                        <path fill="#ea4335" d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/>
                    </svg>
                    Sign up with Google
                </button>
                
                <div class="divider">
                    <span>or</span>
                </div>
                
                <form onsubmit="handleRegister(event)">
                    <div class="form-group">
                        <label for="registerName">Full Name</label>
                        <input type="text" id="registerName" required>
                    </div>
                    <div class="form-group">
                        <label for="registerEmail">Email</label>
                        <input type="email" id="registerEmail" required>
                    </div>
                    <div class="form-group">
                        <label for="registerPassword">Password</label>
                        <input type="password" id="registerPassword" required minlength="6">
                    </div>
                    <div class="form-group">
                        <label for="confirmPassword">Confirm Password</label>
                        <input type="password" id="confirmPassword" required minlength="6">
                    </div>
                    <button type="submit" class="auth-btn">Create Account</button>
                </form>
                <p class="auth-switch">
                    Already have an account? 
                    <a href="#" onclick="showLoginForm()">Sign in here</a>
                </p>
            </div>
        </div>
    </div>

    <div class="container">
        <!-- User Profile Header -->
        <div id="userProfile" class="user-profile" style="display: none;">
            <div class="profile-info">
                <span class="user-name" id="userName"></span>
                <span class="user-email" id="userEmail"></span>
            </div>
            <div class="profile-actions">
                <button class="logout-btn" onclick="handleLogout()">Logout</button>
            </div>
        </div>

        <!-- Login Prompt (shown when not authenticated) -->
        <div id="loginPrompt" class="login-prompt">
            <div class="welcome-content">
                <h1>üéØ Put Options LTP Finder</h1>
                <p>Find the Last Traded Price (LTP) of put options for premium calculation</p>
                <div class="features">
                    <div class="feature">
                        <span class="feature-icon">üìä</span>
                        <span class="feature-text">Real put option LTP lookup</span>
                    </div>
                    <div class="feature">
                        <span class="feature-icon">üîê</span>
                        <span class="feature-text">Secure user authentication</span>
                    </div>
                    <div class="feature">
                        <span class="feature-icon">‚ö°</span>
                        <span class="feature-text">Instant LTP results</span>
                    </div>
                </div>
                <button class="auth-btn primary" onclick="showAuthModal()">Get Started</button>
                <p class="demo-text">Start finding put option prices today</p>
            </div>
        </div>

        <!-- Main App (shown when authenticated) -->
        <div id="mainApp" style="display: none;">
            <header>
                <h1>Put Options LTP Finder</h1>
                <p>Find the Last Traded Price (LTP) of put options for premium calculation</p>
                <div class="demo-notice" style="background: rgba(255,255,255,0.1); padding: 10px; border-radius: 5px; margin-top: 10px; font-size: 0.9rem;">
                    üí° <span id="dataMode">Using demo LTP data</span>
                </div>
            </header>

            <!-- Zerodha Connection Section -->
            <div class="connection-section">
                <div class="connection-card">
                    <div class="connection-status">
                        <span class="connection-icon" id="connectionIcon">üîó</span>
                        <div class="connection-info">
                            <div class="connection-title">Market Data Connection</div>
                            <div class="connection-subtitle" id="connectionStatus">Connect Zerodha for live market data</div>
                        </div>
                    </div>
                    <div class="connection-actions">
                        <button type="button" id="connectZerodhaBtn" class="btn btn-outline btn-sm">
                            Connect Zerodha
                        </button>
                        <button type="button" id="disconnectZerodhaBtn" class="btn btn-outline btn-sm" style="display: none;">
                            Disconnect
                        </button>
                    </div>
                </div>
            </div>

            <div class="calculator-section">
                <div class="form-grid">
                    <div class="form-group">
                        <label for="stockSymbol">Stock Symbol</label>
                        <input type="text" id="stockSymbol" placeholder="e.g., RELIANCE, TCS" required>
                        <small class="form-help" id="lotSizeInfo" style="display: none;"></small>
                    </div>

                    <div class="form-group">
                        <label for="strikePrice">Strike Price (‚Çπ)</label>
                        <input type="number" id="strikePrice" placeholder="e.g., 2500" step="0.01" required>
                    </div>

                    <div class="form-group">
                        <label for="expiryDate">Expiry Date</label>
                        <input type="date" id="expiryDate" required>
                    </div>

                    <div class="form-actions">
                        <button type="button" id="calculatePremium" class="btn btn-primary">Find Put LTP</button>
                        <button type="reset" class="btn btn-outline">Clear</button>
                    </div>
                </div>
            </div>

            <div id="resultsSection" class="results-section" style="display: none;">
                <h2>Put Option LTP</h2>
                <div class="premium-result">
                    <div class="premium-card">
                        <div class="premium-label">Put Option Premium (LTP)</div>
                        <div class="premium-value" id="totalPremium">‚Çπ0.00</div>
                        <div class="premium-subtitle" id="premiumDetails"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="script.js"></script>
</body>
</html>